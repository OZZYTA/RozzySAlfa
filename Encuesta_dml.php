<?php

// Data functions (insert, update, delete, form) for table Encuesta

// This script and data application were generated by AppGini 5.97
// Download AppGini for free from https://bigprof.com/appgini/download/

function Encuesta_insert(&$error_message = '') {
	global $Translation;

	// mm: can member insert record?
	$arrPerm = getTablePermissions('Encuesta');
	if(!$arrPerm['insert']) return false;

	$data = [
		'fecha' => parseCode('<%%creationDate%%>', true, true),
		'tipoid' => Request::val('tipoid', ''),
		'doc' => Request::val('doc', ''),
		'nombres' => Request::val('nombres', ''),
		'apellidos' => Request::val('apellidos', ''),
		'eps' => Request::lookup('eps', ''),
		'ipsprim' => Request::lookup('ipsprim', ''),
		'tratoser' => Request::val('tratoser', ''),
		'cita' => Request::val('cita', ''),
		'tratoasis' => Request::val('tratoasis', ''),
		'expprof' => Request::val('expprof', ''),
		'bioser' => Request::val('bioser', ''),
		'area' => Request::val('area', ''),
		'pyp' => Request::val('pyp', ''),
		'prenatal' => Request::val('prenatal', ''),
		'cyd' => Request::val('cyd', ''),
		'vacunas' => Request::val('vacunas', ''),
		'pfm' => Request::val('pfm', ''),
		'citologia' => Request::val('citologia', ''),
		'sservicio' => Request::val('sservicio', ''),
		'incomodo' => Request::val('incomodo', ''),
		'otro' => Request::val('otro', ''),
		'why' => br2nl(Request::val('why', '')),
		'urgencia' => Request::val('urgencia', ''),
		'citaoportuna' => Request::val('citaoportuna', ''),
		'aspectoeps' => Request::val('aspectoeps', ''),
		'fisicas' => Request::val('fisicas', ''),
		'aseo' => Request::val('aseo', ''),
		'capacitacion' => Request::val('capacitacion', ''),
		'autorizaciones' => Request::val('autorizaciones', ''),
		'general' => Request::val('general', ''),
		'horario' => Request::val('horario', ''),
		'formulario' => Request::val('formulario', ''),
		'farmacia' => Request::val('farmacia', ''),
		'fisicasfarma' => Request::val('fisicasfarma', ''),
		'oporfarmacia' => Request::val('oporfarmacia', ''),
		'totalidad' => Request::val('totalidad', ''),
		'cambio' => Request::val('cambio', ''),
		'volver' => Request::val('volver', ''),
		'orientacion' => Request::val('orientacion', ''),
		'embalaje' => Request::val('embalaje', ''),
		'revision' => Request::val('revision', ''),
		'observaciones' => br2nl(Request::val('observaciones', 'NINGUNA')),
	];

	if($data['tipoid'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Tipo de Documento:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['doc'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Numero de Documento': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['nombres'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Nombres': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['apellidos'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Apellidos': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['eps'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'EPS': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['tratoser'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Al Utilizar el Servicio &#191;El trato Fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['cita'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La asignaci&#243;n de citas para el servicio fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['tratoasis'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;El trato que recibi&#243; y el tiempo dedicado por parte del personal asistencial fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['expprof'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La explicaci&#243;n dada por el profesional de la salud, sobre el cuidado tratamiento y mantenimiento de la salud fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['bioser'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Las condiciones de bioseguridad (uso de tapabocas, canecas, guantes, etc) utilizadas por los profesionales de la salud fueron?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['area'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;C&#243;mo califica el &#225;rea donde fue antendido en cuanto a aseo y comodidad?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['pyp'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Lo han invitado a programas de Promoci&#243;n y Prevenci&#243;n?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['prenatal'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Asiste a Control Prenatal? (Solo mujeres embarazadas)': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['cyd'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Sus hijos menores de 10 a&#241;os asisten a control de crecimiento y desarrollo?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['vacunas'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Sus hijos menores de 5 a&#241;os han sido vacunados?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['pfm'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Qu&#233; m&#233;todo de planificaci&#243;n familiar usa?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['citologia'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Cu&#225;ndo fue su &#250;ltima citolog&#237;a?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['sservicio'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Califique su satisfacci&#243;n con el servicio recibido en el centro de salud': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['incomodo'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Especialmente con cual de los servicios se ha sentido incomodo?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['urgencia'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Lo han atendido oportunamente cuando se ha presentado una urgencia?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['citaoportuna'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La asignaci&#243;n de citas ha sido oportuna?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['aspectoeps'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Al utilizar el servicio &#191;el trato que recibi&#243; fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['fisicas'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Las condiciones fisicas en las instalaciones de la EPS son?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['aseo'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'El &#225;rea donde fue atendido en cuanto a aseo, higiene y comodidad es:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['capacitacion'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La capacitaci&#243;n brindada por la EPS sobre sus derechos y deberes fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['autorizaciones'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'La gesti&#243;n de las autorizaciones y/o tratamientos por parte de la EPS fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['general'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Ud considera que la EPS en general es?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['horario'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'El personal de la EPS lo atiende oportunamente dentro del horario de atenci&#243;n al p&#250;blico?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['formulario'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'El personal administrativo de la EPS le entreg&#243; copia del formulario de afiliaci&#243;n y/o traslado?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['farmacia'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Como fue el trato que recibio por parte del personal de famarcia que lo ha atendido?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['fisicasfarma'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Las condiciones fisicas en la prestaci&#243;n del servicio de farmacia y/o drogueria fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['oporfarmacia'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La oportunidad en la prestaci&#243;n del servicio de farmacia y/o droguer&#237;a fue? ': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['totalidad'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Le entregaron la totalidad de los medicamentos? ': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['cambio'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Le gustar&#237;a que la EPS cambiara el servicio de farmacia y/o droguer&#237;a?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['volver'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Cu&#225;ntas veces ha tenido que volver a la farmacia y/o droguer&#237;a por medicamentos pendientes?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['orientacion'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La persona encargada de suministrar la medicina, le orienta en el consumo y conservaci&#243;n de los medicamentos? ': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['embalaje'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;En qu&#233; condiciones le entregan a usted el medicamento en el servicio de farmacia y/o droguer&#237;a?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['revision'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;El personal que lo atendi&#243; revis&#243; con usted los medicamentos antes de hacer la entrega? ': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}

	// hook: Encuesta_before_insert
	if(function_exists('Encuesta_before_insert')) {
		$args = [];
		if(!Encuesta_before_insert($data, getMemberInfo(), $args)) {
			if(isset($args['error_message'])) $error_message = $args['error_message'];
			return false;
		}
	}

	$error = '';
	// set empty fields to NULL
	$data = array_map(function($v) { return ($v === '' ? NULL : $v); }, $data);
	insert('Encuesta', backtick_keys_once($data), $error);
	if($error)
		die("{$error}<br><a href=\"#\" onclick=\"history.go(-1);\">{$Translation['< back']}</a>");

	$recID = db_insert_id(db_link());

	update_calc_fields('Encuesta', $recID, calculated_fields()['Encuesta']);

	// hook: Encuesta_after_insert
	if(function_exists('Encuesta_after_insert')) {
		$res = sql("SELECT * FROM `Encuesta` WHERE `id`='" . makeSafe($recID, false) . "' LIMIT 1", $eo);
		if($row = db_fetch_assoc($res)) {
			$data = array_map('makeSafe', $row);
		}
		$data['selectedID'] = makeSafe($recID, false);
		$args=[];
		if(!Encuesta_after_insert($data, getMemberInfo(), $args)) { return $recID; }
	}

	// mm: save ownership data
	set_record_owner('Encuesta', $recID, getLoggedMemberID());

	// if this record is a copy of another record, copy children if applicable
	if(!empty($_REQUEST['SelectedID'])) Encuesta_copy_children($recID, $_REQUEST['SelectedID']);

	return $recID;
}

function Encuesta_copy_children($destination_id, $source_id) {
	global $Translation;
	$requests = []; // array of curl handlers for launching insert requests
	$eo = ['silentErrors' => true];
	$safe_sid = makeSafe($source_id);

	// launch requests, asynchronously
	curl_batch($requests);
}

function Encuesta_delete($selected_id, $AllowDeleteOfParents = false, $skipChecks = false) {
	// insure referential integrity ...
	global $Translation;
	$selected_id = makeSafe($selected_id);

	// mm: can member delete record?
	if(!check_record_permission('Encuesta', $selected_id, 'delete')) {
		return $Translation['You don\'t have enough permissions to delete this record'];
	}

	// hook: Encuesta_before_delete
	if(function_exists('Encuesta_before_delete')) {
		$args = [];
		if(!Encuesta_before_delete($selected_id, $skipChecks, getMemberInfo(), $args))
			return $Translation['Couldn\'t delete this record'] . (
				!empty($args['error_message']) ?
					'<div class="text-bold">' . strip_tags($args['error_message']) . '</div>'
					: '' 
			);
	}

	sql("DELETE FROM `Encuesta` WHERE `id`='{$selected_id}'", $eo);

	// hook: Encuesta_after_delete
	if(function_exists('Encuesta_after_delete')) {
		$args = [];
		Encuesta_after_delete($selected_id, getMemberInfo(), $args);
	}

	// mm: delete ownership data
	sql("DELETE FROM `membership_userrecords` WHERE `tableName`='Encuesta' AND `pkValue`='{$selected_id}'", $eo);
}

function Encuesta_update(&$selected_id, &$error_message = '') {
	global $Translation;

	// mm: can member edit record?
	if(!check_record_permission('Encuesta', $selected_id, 'edit')) return false;

	$data = [
		'tipoid' => Request::val('tipoid', ''),
		'doc' => Request::val('doc', ''),
		'nombres' => Request::val('nombres', ''),
		'apellidos' => Request::val('apellidos', ''),
		'eps' => Request::lookup('eps', ''),
		'ipsprim' => Request::lookup('ipsprim', ''),
		'tratoser' => Request::val('tratoser', ''),
		'cita' => Request::val('cita', ''),
		'tratoasis' => Request::val('tratoasis', ''),
		'expprof' => Request::val('expprof', ''),
		'bioser' => Request::val('bioser', ''),
		'area' => Request::val('area', ''),
		'pyp' => Request::val('pyp', ''),
		'prenatal' => Request::val('prenatal', ''),
		'cyd' => Request::val('cyd', ''),
		'vacunas' => Request::val('vacunas', ''),
		'pfm' => Request::val('pfm', ''),
		'citologia' => Request::val('citologia', ''),
		'sservicio' => Request::val('sservicio', ''),
		'incomodo' => Request::val('incomodo', ''),
		'otro' => Request::val('otro', ''),
		'why' => br2nl(Request::val('why', '')),
		'urgencia' => Request::val('urgencia', ''),
		'citaoportuna' => Request::val('citaoportuna', ''),
		'aspectoeps' => Request::val('aspectoeps', ''),
		'fisicas' => Request::val('fisicas', ''),
		'aseo' => Request::val('aseo', ''),
		'capacitacion' => Request::val('capacitacion', ''),
		'autorizaciones' => Request::val('autorizaciones', ''),
		'general' => Request::val('general', ''),
		'horario' => Request::val('horario', ''),
		'formulario' => Request::val('formulario', ''),
		'farmacia' => Request::val('farmacia', ''),
		'fisicasfarma' => Request::val('fisicasfarma', ''),
		'oporfarmacia' => Request::val('oporfarmacia', ''),
		'totalidad' => Request::val('totalidad', ''),
		'cambio' => Request::val('cambio', ''),
		'volver' => Request::val('volver', ''),
		'orientacion' => Request::val('orientacion', ''),
		'embalaje' => Request::val('embalaje', ''),
		'revision' => Request::val('revision', ''),
		'observaciones' => br2nl(Request::val('observaciones', '')),
	];

	if($data['tipoid'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Tipo de Documento:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['doc'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Numero de Documento': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['nombres'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Nombres': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['apellidos'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Apellidos': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['eps'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'EPS': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['tratoser'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Al Utilizar el Servicio &#191;El trato Fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['cita'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La asignaci&#243;n de citas para el servicio fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['tratoasis'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;El trato que recibi&#243; y el tiempo dedicado por parte del personal asistencial fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['expprof'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La explicaci&#243;n dada por el profesional de la salud, sobre el cuidado tratamiento y mantenimiento de la salud fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['bioser'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Las condiciones de bioseguridad (uso de tapabocas, canecas, guantes, etc) utilizadas por los profesionales de la salud fueron?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['area'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;C&#243;mo califica el &#225;rea donde fue antendido en cuanto a aseo y comodidad?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['pyp'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Lo han invitado a programas de Promoci&#243;n y Prevenci&#243;n?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['prenatal'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Asiste a Control Prenatal? (Solo mujeres embarazadas)': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['cyd'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Sus hijos menores de 10 a&#241;os asisten a control de crecimiento y desarrollo?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['vacunas'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Sus hijos menores de 5 a&#241;os han sido vacunados?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['pfm'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Qu&#233; m&#233;todo de planificaci&#243;n familiar usa?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['citologia'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Cu&#225;ndo fue su &#250;ltima citolog&#237;a?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['sservicio'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Califique su satisfacci&#243;n con el servicio recibido en el centro de salud': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['incomodo'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Especialmente con cual de los servicios se ha sentido incomodo?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['urgencia'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Lo han atendido oportunamente cuando se ha presentado una urgencia?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['citaoportuna'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La asignaci&#243;n de citas ha sido oportuna?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['aspectoeps'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Al utilizar el servicio &#191;el trato que recibi&#243; fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['fisicas'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Las condiciones fisicas en las instalaciones de la EPS son?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['aseo'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'El &#225;rea donde fue atendido en cuanto a aseo, higiene y comodidad es:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['capacitacion'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La capacitaci&#243;n brindada por la EPS sobre sus derechos y deberes fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['autorizaciones'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'La gesti&#243;n de las autorizaciones y/o tratamientos por parte de la EPS fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['general'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Ud considera que la EPS en general es?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['horario'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'El personal de la EPS lo atiende oportunamente dentro del horario de atenci&#243;n al p&#250;blico?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['formulario'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'El personal administrativo de la EPS le entreg&#243; copia del formulario de afiliaci&#243;n y/o traslado?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['farmacia'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Como fue el trato que recibio por parte del personal de famarcia que lo ha atendido?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['fisicasfarma'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Las condiciones fisicas en la prestaci&#243;n del servicio de farmacia y/o drogueria fue?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['oporfarmacia'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La oportunidad en la prestaci&#243;n del servicio de farmacia y/o droguer&#237;a fue? ': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['totalidad'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Le entregaron la totalidad de los medicamentos? ': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['cambio'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Le gustar&#237;a que la EPS cambiara el servicio de farmacia y/o droguer&#237;a?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['volver'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;Cu&#225;ntas veces ha tenido que volver a la farmacia y/o droguer&#237;a por medicamentos pendientes?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['orientacion'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;La persona encargada de suministrar la medicina, le orienta en el consumo y conservaci&#243;n de los medicamentos? ': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['embalaje'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;En qu&#233; condiciones le entregan a usted el medicamento en el servicio de farmacia y/o droguer&#237;a?': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['revision'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} '&#191;El personal que lo atendi&#243; revis&#243; con usted los medicamentos antes de hacer la entrega? ': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	// get existing values
	$old_data = getRecord('Encuesta', $selected_id);
	if(is_array($old_data)) {
		$old_data = array_map('makeSafe', $old_data);
		$old_data['selectedID'] = makeSafe($selected_id);
	}

	$data['selectedID'] = makeSafe($selected_id);

	// hook: Encuesta_before_update
	if(function_exists('Encuesta_before_update')) {
		$args = ['old_data' => $old_data];
		if(!Encuesta_before_update($data, getMemberInfo(), $args)) {
			if(isset($args['error_message'])) $error_message = $args['error_message'];
			return false;
		}
	}

	$set = $data; unset($set['selectedID']);
	foreach ($set as $field => $value) {
		$set[$field] = ($value !== '' && $value !== NULL) ? $value : NULL;
	}

	if(!update(
		'Encuesta', 
		backtick_keys_once($set), 
		['`id`' => $selected_id], 
		$error_message
	)) {
		echo $error_message;
		echo '<a href="Encuesta_view.php?SelectedID=' . urlencode($selected_id) . "\">{$Translation['< back']}</a>";
		exit;
	}


	$eo = ['silentErrors' => true];

	update_calc_fields('Encuesta', $data['selectedID'], calculated_fields()['Encuesta']);

	// hook: Encuesta_after_update
	if(function_exists('Encuesta_after_update')) {
		$res = sql("SELECT * FROM `Encuesta` WHERE `id`='{$data['selectedID']}' LIMIT 1", $eo);
		if($row = db_fetch_assoc($res)) $data = array_map('makeSafe', $row);

		$data['selectedID'] = $data['id'];
		$args = ['old_data' => $old_data];
		if(!Encuesta_after_update($data, getMemberInfo(), $args)) return;
	}

	// mm: update ownership data
	sql("UPDATE `membership_userrecords` SET `dateUpdated`='" . time() . "' WHERE `tableName`='Encuesta' AND `pkValue`='" . makeSafe($selected_id) . "'", $eo);
}

function Encuesta_form($selected_id = '', $AllowUpdate = 1, $AllowInsert = 1, $AllowDelete = 1, $ShowCancel = 0, $TemplateDV = '', $TemplateDVP = '') {
	// function to return an editable form for a table records
	// and fill it with data of record whose ID is $selected_id. If $selected_id
	// is empty, an empty form is shown, with only an 'Add New'
	// button displayed.

	global $Translation;

	// mm: get table permissions
	$arrPerm = getTablePermissions('Encuesta');
	if(!$arrPerm['insert'] && $selected_id=='') return $Translation['tableAccessDenied'];
	$AllowInsert = ($arrPerm['insert'] ? true : false);
	// print preview?
	$dvprint = false;
	if($selected_id && $_REQUEST['dvprint_x'] != '') {
		$dvprint = true;
	}

	$filterer_eps = thisOr($_REQUEST['filterer_eps'], '');
	$filterer_ipsprim = thisOr($_REQUEST['filterer_ipsprim'], '');

	// populate filterers, starting from children to grand-parents

	// unique random identifier
	$rnd1 = ($dvprint ? rand(1000000, 9999999) : '');
	// combobox: fecha
	$combo_fecha = new DateCombo;
	$combo_fecha->DateFormat = "dmy";
	$combo_fecha->MinYear = 1900;
	$combo_fecha->MaxYear = 2100;
	$combo_fecha->DefaultDate = parseMySQLDate('<%%creationDate%%>', '<%%creationDate%%>');
	$combo_fecha->MonthNames = $Translation['month names'];
	$combo_fecha->NamePrefix = 'fecha';
	// combobox: tipoid
	$combo_tipoid = new Combo;
	$combo_tipoid->ListType = 0;
	$combo_tipoid->MultipleSeparator = ', ';
	$combo_tipoid->ListBoxHeight = 10;
	$combo_tipoid->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.tipoid.csv')) {
		$tipoid_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.tipoid.csv')));
		$combo_tipoid->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($tipoid_data)));
		$combo_tipoid->ListData = $combo_tipoid->ListItem;
	} else {
		$combo_tipoid->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;RC;;TI;;CC;;PAS;;PEP;;Otro")));
		$combo_tipoid->ListData = $combo_tipoid->ListItem;
	}
	$combo_tipoid->SelectName = 'tipoid';
	$combo_tipoid->AllowNull = false;
	// combobox: eps
	$combo_eps = new DataCombo;
	// combobox: ipsprim
	$combo_ipsprim = new DataCombo;
	// combobox: tratoser
	$combo_tratoser = new Combo;
	$combo_tratoser->ListType = 0;
	$combo_tratoser->MultipleSeparator = ', ';
	$combo_tratoser->ListBoxHeight = 10;
	$combo_tratoser->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.tratoser.csv')) {
		$tratoser_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.tratoser.csv')));
		$combo_tratoser->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($tratoser_data)));
		$combo_tratoser->ListData = $combo_tratoser->ListItem;
	} else {
		$combo_tratoser->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENO;;REGULAR;;MALO")));
		$combo_tratoser->ListData = $combo_tratoser->ListItem;
	}
	$combo_tratoser->SelectName = 'tratoser';
	$combo_tratoser->AllowNull = false;
	// combobox: cita
	$combo_cita = new Combo;
	$combo_cita->ListType = 0;
	$combo_cita->MultipleSeparator = ', ';
	$combo_cita->ListBoxHeight = 10;
	$combo_cita->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.cita.csv')) {
		$cita_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.cita.csv')));
		$combo_cita->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($cita_data)));
		$combo_cita->ListData = $combo_cita->ListItem;
	} else {
		$combo_cita->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENA;;REGULAR;;MALA")));
		$combo_cita->ListData = $combo_cita->ListItem;
	}
	$combo_cita->SelectName = 'cita';
	$combo_cita->AllowNull = false;
	// combobox: tratoasis
	$combo_tratoasis = new Combo;
	$combo_tratoasis->ListType = 0;
	$combo_tratoasis->MultipleSeparator = ', ';
	$combo_tratoasis->ListBoxHeight = 10;
	$combo_tratoasis->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.tratoasis.csv')) {
		$tratoasis_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.tratoasis.csv')));
		$combo_tratoasis->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($tratoasis_data)));
		$combo_tratoasis->ListData = $combo_tratoasis->ListItem;
	} else {
		$combo_tratoasis->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENO;;REGULAR;;MALO")));
		$combo_tratoasis->ListData = $combo_tratoasis->ListItem;
	}
	$combo_tratoasis->SelectName = 'tratoasis';
	$combo_tratoasis->AllowNull = false;
	// combobox: expprof
	$combo_expprof = new Combo;
	$combo_expprof->ListType = 0;
	$combo_expprof->MultipleSeparator = ', ';
	$combo_expprof->ListBoxHeight = 10;
	$combo_expprof->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.expprof.csv')) {
		$expprof_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.expprof.csv')));
		$combo_expprof->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($expprof_data)));
		$combo_expprof->ListData = $combo_expprof->ListItem;
	} else {
		$combo_expprof->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENA;;REGULAR;;MALA")));
		$combo_expprof->ListData = $combo_expprof->ListItem;
	}
	$combo_expprof->SelectName = 'expprof';
	$combo_expprof->AllowNull = false;
	// combobox: bioser
	$combo_bioser = new Combo;
	$combo_bioser->ListType = 0;
	$combo_bioser->MultipleSeparator = ', ';
	$combo_bioser->ListBoxHeight = 10;
	$combo_bioser->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.bioser.csv')) {
		$bioser_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.bioser.csv')));
		$combo_bioser->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($bioser_data)));
		$combo_bioser->ListData = $combo_bioser->ListItem;
	} else {
		$combo_bioser->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTES;;BUENAS;;MALAS;;REGULARES")));
		$combo_bioser->ListData = $combo_bioser->ListItem;
	}
	$combo_bioser->SelectName = 'bioser';
	$combo_bioser->AllowNull = false;
	// combobox: area
	$combo_area = new Combo;
	$combo_area->ListType = 0;
	$combo_area->MultipleSeparator = ', ';
	$combo_area->ListBoxHeight = 10;
	$combo_area->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.area.csv')) {
		$area_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.area.csv')));
		$combo_area->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($area_data)));
		$combo_area->ListData = $combo_area->ListItem;
	} else {
		$combo_area->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENA;;REGULAR;;MALA")));
		$combo_area->ListData = $combo_area->ListItem;
	}
	$combo_area->SelectName = 'area';
	$combo_area->AllowNull = false;
	// combobox: pyp
	$combo_pyp = new Combo;
	$combo_pyp->ListType = 0;
	$combo_pyp->MultipleSeparator = ', ';
	$combo_pyp->ListBoxHeight = 10;
	$combo_pyp->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.pyp.csv')) {
		$pyp_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.pyp.csv')));
		$combo_pyp->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($pyp_data)));
		$combo_pyp->ListData = $combo_pyp->ListItem;
	} else {
		$combo_pyp->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO")));
		$combo_pyp->ListData = $combo_pyp->ListItem;
	}
	$combo_pyp->SelectName = 'pyp';
	$combo_pyp->AllowNull = false;
	// combobox: prenatal
	$combo_prenatal = new Combo;
	$combo_prenatal->ListType = 0;
	$combo_prenatal->MultipleSeparator = ', ';
	$combo_prenatal->ListBoxHeight = 10;
	$combo_prenatal->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.prenatal.csv')) {
		$prenatal_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.prenatal.csv')));
		$combo_prenatal->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($prenatal_data)));
		$combo_prenatal->ListData = $combo_prenatal->ListItem;
	} else {
		$combo_prenatal->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO;;NO APLICA")));
		$combo_prenatal->ListData = $combo_prenatal->ListItem;
	}
	$combo_prenatal->SelectName = 'prenatal';
	$combo_prenatal->AllowNull = false;
	// combobox: cyd
	$combo_cyd = new Combo;
	$combo_cyd->ListType = 0;
	$combo_cyd->MultipleSeparator = ', ';
	$combo_cyd->ListBoxHeight = 10;
	$combo_cyd->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.cyd.csv')) {
		$cyd_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.cyd.csv')));
		$combo_cyd->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($cyd_data)));
		$combo_cyd->ListData = $combo_cyd->ListItem;
	} else {
		$combo_cyd->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO;;NO APLICA")));
		$combo_cyd->ListData = $combo_cyd->ListItem;
	}
	$combo_cyd->SelectName = 'cyd';
	$combo_cyd->AllowNull = false;
	// combobox: vacunas
	$combo_vacunas = new Combo;
	$combo_vacunas->ListType = 0;
	$combo_vacunas->MultipleSeparator = ', ';
	$combo_vacunas->ListBoxHeight = 10;
	$combo_vacunas->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.vacunas.csv')) {
		$vacunas_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.vacunas.csv')));
		$combo_vacunas->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($vacunas_data)));
		$combo_vacunas->ListData = $combo_vacunas->ListItem;
	} else {
		$combo_vacunas->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO;;NO APLICA")));
		$combo_vacunas->ListData = $combo_vacunas->ListItem;
	}
	$combo_vacunas->SelectName = 'vacunas';
	$combo_vacunas->AllowNull = false;
	// combobox: pfm
	$combo_pfm = new Combo;
	$combo_pfm->ListType = 0;
	$combo_pfm->MultipleSeparator = ', ';
	$combo_pfm->ListBoxHeight = 10;
	$combo_pfm->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.pfm.csv')) {
		$pfm_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.pfm.csv')));
		$combo_pfm->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($pfm_data)));
		$combo_pfm->ListData = $combo_pfm->ListItem;
	} else {
		$combo_pfm->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;CONDON;;PILDORA;;INYECCION;;DIU;;OTRO;;NINGUNO;;NO APLICA")));
		$combo_pfm->ListData = $combo_pfm->ListItem;
	}
	$combo_pfm->SelectName = 'pfm';
	$combo_pfm->AllowNull = false;
	// combobox: citologia
	$combo_citologia = new Combo;
	$combo_citologia->ListType = 0;
	$combo_citologia->MultipleSeparator = ', ';
	$combo_citologia->ListBoxHeight = 10;
	$combo_citologia->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.citologia.csv')) {
		$citologia_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.citologia.csv')));
		$combo_citologia->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($citologia_data)));
		$combo_citologia->ListData = $combo_citologia->ListItem;
	} else {
		$combo_citologia->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;3 MESES;;6 MESES;;1 A&#209;O;;NO SE HA REALIZADO;;NO APLICA")));
		$combo_citologia->ListData = $combo_citologia->ListItem;
	}
	$combo_citologia->SelectName = 'citologia';
	$combo_citologia->AllowNull = false;
	// combobox: sservicio
	$combo_sservicio = new Combo;
	$combo_sservicio->ListType = 0;
	$combo_sservicio->MultipleSeparator = ', ';
	$combo_sservicio->ListBoxHeight = 10;
	$combo_sservicio->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.sservicio.csv')) {
		$sservicio_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.sservicio.csv')));
		$combo_sservicio->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($sservicio_data)));
		$combo_sservicio->ListData = $combo_sservicio->ListItem;
	} else {
		$combo_sservicio->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENO;;REGULAR;;MALO")));
		$combo_sservicio->ListData = $combo_sservicio->ListItem;
	}
	$combo_sservicio->SelectName = 'sservicio';
	$combo_sservicio->AllowNull = false;
	// combobox: incomodo
	$combo_incomodo = new Combo;
	$combo_incomodo->ListType = 0;
	$combo_incomodo->MultipleSeparator = ', ';
	$combo_incomodo->ListBoxHeight = 10;
	$combo_incomodo->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.incomodo.csv')) {
		$incomodo_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.incomodo.csv')));
		$combo_incomodo->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($incomodo_data)));
		$combo_incomodo->ListData = $combo_incomodo->ListItem;
	} else {
		$combo_incomodo->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;CONSULTA MEDICA;;CONSULTA ODONTOLOGICA;;CONSULTA DE URGENCIAS;;ENTREGA DE MEDICAMENTOS;;ACTIVIDADES DE PYP;;REMISION A ESPECIALISTA;;LABORATORIO CLINICO;;OTRO;;NINGUNO")));
		$combo_incomodo->ListData = $combo_incomodo->ListItem;
	}
	$combo_incomodo->SelectName = 'incomodo';
	$combo_incomodo->AllowNull = false;
	// combobox: urgencia
	$combo_urgencia = new Combo;
	$combo_urgencia->ListType = 0;
	$combo_urgencia->MultipleSeparator = ', ';
	$combo_urgencia->ListBoxHeight = 10;
	$combo_urgencia->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.urgencia.csv')) {
		$urgencia_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.urgencia.csv')));
		$combo_urgencia->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($urgencia_data)));
		$combo_urgencia->ListData = $combo_urgencia->ListItem;
	} else {
		$combo_urgencia->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO;;NO HE REQUERIDO EL SERVICIO")));
		$combo_urgencia->ListData = $combo_urgencia->ListItem;
	}
	$combo_urgencia->SelectName = 'urgencia';
	$combo_urgencia->AllowNull = false;
	// combobox: citaoportuna
	$combo_citaoportuna = new Combo;
	$combo_citaoportuna->ListType = 0;
	$combo_citaoportuna->MultipleSeparator = ', ';
	$combo_citaoportuna->ListBoxHeight = 10;
	$combo_citaoportuna->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.citaoportuna.csv')) {
		$citaoportuna_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.citaoportuna.csv')));
		$combo_citaoportuna->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($citaoportuna_data)));
		$combo_citaoportuna->ListData = $combo_citaoportuna->ListItem;
	} else {
		$combo_citaoportuna->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO")));
		$combo_citaoportuna->ListData = $combo_citaoportuna->ListItem;
	}
	$combo_citaoportuna->SelectName = 'citaoportuna';
	$combo_citaoportuna->AllowNull = false;
	// combobox: aspectoeps
	$combo_aspectoeps = new Combo;
	$combo_aspectoeps->ListType = 0;
	$combo_aspectoeps->MultipleSeparator = ', ';
	$combo_aspectoeps->ListBoxHeight = 10;
	$combo_aspectoeps->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.aspectoeps.csv')) {
		$aspectoeps_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.aspectoeps.csv')));
		$combo_aspectoeps->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($aspectoeps_data)));
		$combo_aspectoeps->ListData = $combo_aspectoeps->ListItem;
	} else {
		$combo_aspectoeps->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENO;;REGULAR;;MALO")));
		$combo_aspectoeps->ListData = $combo_aspectoeps->ListItem;
	}
	$combo_aspectoeps->SelectName = 'aspectoeps';
	$combo_aspectoeps->AllowNull = false;
	// combobox: fisicas
	$combo_fisicas = new Combo;
	$combo_fisicas->ListType = 0;
	$combo_fisicas->MultipleSeparator = ', ';
	$combo_fisicas->ListBoxHeight = 10;
	$combo_fisicas->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.fisicas.csv')) {
		$fisicas_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.fisicas.csv')));
		$combo_fisicas->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($fisicas_data)));
		$combo_fisicas->ListData = $combo_fisicas->ListItem;
	} else {
		$combo_fisicas->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTES;;BUENAS;;REGULARES;;MALAS")));
		$combo_fisicas->ListData = $combo_fisicas->ListItem;
	}
	$combo_fisicas->SelectName = 'fisicas';
	$combo_fisicas->AllowNull = false;
	// combobox: aseo
	$combo_aseo = new Combo;
	$combo_aseo->ListType = 0;
	$combo_aseo->MultipleSeparator = ', ';
	$combo_aseo->ListBoxHeight = 10;
	$combo_aseo->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.aseo.csv')) {
		$aseo_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.aseo.csv')));
		$combo_aseo->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($aseo_data)));
		$combo_aseo->ListData = $combo_aseo->ListItem;
	} else {
		$combo_aseo->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENA;;REGULAR;;MALA")));
		$combo_aseo->ListData = $combo_aseo->ListItem;
	}
	$combo_aseo->SelectName = 'aseo';
	$combo_aseo->AllowNull = false;
	// combobox: capacitacion
	$combo_capacitacion = new Combo;
	$combo_capacitacion->ListType = 0;
	$combo_capacitacion->MultipleSeparator = ', ';
	$combo_capacitacion->ListBoxHeight = 10;
	$combo_capacitacion->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.capacitacion.csv')) {
		$capacitacion_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.capacitacion.csv')));
		$combo_capacitacion->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($capacitacion_data)));
		$combo_capacitacion->ListData = $combo_capacitacion->ListItem;
	} else {
		$combo_capacitacion->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENA;;REGULAR;;MALA")));
		$combo_capacitacion->ListData = $combo_capacitacion->ListItem;
	}
	$combo_capacitacion->SelectName = 'capacitacion';
	$combo_capacitacion->AllowNull = false;
	// combobox: autorizaciones
	$combo_autorizaciones = new Combo;
	$combo_autorizaciones->ListType = 0;
	$combo_autorizaciones->MultipleSeparator = ', ';
	$combo_autorizaciones->ListBoxHeight = 10;
	$combo_autorizaciones->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.autorizaciones.csv')) {
		$autorizaciones_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.autorizaciones.csv')));
		$combo_autorizaciones->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($autorizaciones_data)));
		$combo_autorizaciones->ListData = $combo_autorizaciones->ListItem;
	} else {
		$combo_autorizaciones->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENA;;REGULAR;;MALA")));
		$combo_autorizaciones->ListData = $combo_autorizaciones->ListItem;
	}
	$combo_autorizaciones->SelectName = 'autorizaciones';
	$combo_autorizaciones->AllowNull = false;
	// combobox: general
	$combo_general = new Combo;
	$combo_general->ListType = 0;
	$combo_general->MultipleSeparator = ', ';
	$combo_general->ListBoxHeight = 10;
	$combo_general->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.general.csv')) {
		$general_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.general.csv')));
		$combo_general->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($general_data)));
		$combo_general->ListData = $combo_general->ListItem;
	} else {
		$combo_general->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENA;;REGULAR;;MALA")));
		$combo_general->ListData = $combo_general->ListItem;
	}
	$combo_general->SelectName = 'general';
	$combo_general->AllowNull = false;
	// combobox: horario
	$combo_horario = new Combo;
	$combo_horario->ListType = 0;
	$combo_horario->MultipleSeparator = ', ';
	$combo_horario->ListBoxHeight = 10;
	$combo_horario->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.horario.csv')) {
		$horario_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.horario.csv')));
		$combo_horario->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($horario_data)));
		$combo_horario->ListData = $combo_horario->ListItem;
	} else {
		$combo_horario->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO")));
		$combo_horario->ListData = $combo_horario->ListItem;
	}
	$combo_horario->SelectName = 'horario';
	$combo_horario->AllowNull = false;
	// combobox: formulario
	$combo_formulario = new Combo;
	$combo_formulario->ListType = 0;
	$combo_formulario->MultipleSeparator = ', ';
	$combo_formulario->ListBoxHeight = 10;
	$combo_formulario->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.formulario.csv')) {
		$formulario_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.formulario.csv')));
		$combo_formulario->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($formulario_data)));
		$combo_formulario->ListData = $combo_formulario->ListItem;
	} else {
		$combo_formulario->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO;;NO APLICA")));
		$combo_formulario->ListData = $combo_formulario->ListItem;
	}
	$combo_formulario->SelectName = 'formulario';
	$combo_formulario->AllowNull = false;
	// combobox: farmacia
	$combo_farmacia = new Combo;
	$combo_farmacia->ListType = 0;
	$combo_farmacia->MultipleSeparator = ', ';
	$combo_farmacia->ListBoxHeight = 10;
	$combo_farmacia->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.farmacia.csv')) {
		$farmacia_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.farmacia.csv')));
		$combo_farmacia->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($farmacia_data)));
		$combo_farmacia->ListData = $combo_farmacia->ListItem;
	} else {
		$combo_farmacia->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENO;;REGULAR;;MALO")));
		$combo_farmacia->ListData = $combo_farmacia->ListItem;
	}
	$combo_farmacia->SelectName = 'farmacia';
	$combo_farmacia->AllowNull = false;
	// combobox: fisicasfarma
	$combo_fisicasfarma = new Combo;
	$combo_fisicasfarma->ListType = 0;
	$combo_fisicasfarma->MultipleSeparator = ', ';
	$combo_fisicasfarma->ListBoxHeight = 10;
	$combo_fisicasfarma->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.fisicasfarma.csv')) {
		$fisicasfarma_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.fisicasfarma.csv')));
		$combo_fisicasfarma->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($fisicasfarma_data)));
		$combo_fisicasfarma->ListData = $combo_fisicasfarma->ListItem;
	} else {
		$combo_fisicasfarma->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTES;;BUENAS;;REGULARES;;MALAS")));
		$combo_fisicasfarma->ListData = $combo_fisicasfarma->ListItem;
	}
	$combo_fisicasfarma->SelectName = 'fisicasfarma';
	$combo_fisicasfarma->AllowNull = false;
	// combobox: oporfarmacia
	$combo_oporfarmacia = new Combo;
	$combo_oporfarmacia->ListType = 0;
	$combo_oporfarmacia->MultipleSeparator = ', ';
	$combo_oporfarmacia->ListBoxHeight = 10;
	$combo_oporfarmacia->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.oporfarmacia.csv')) {
		$oporfarmacia_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.oporfarmacia.csv')));
		$combo_oporfarmacia->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($oporfarmacia_data)));
		$combo_oporfarmacia->ListData = $combo_oporfarmacia->ListItem;
	} else {
		$combo_oporfarmacia->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;EXCELENTE;;BUENA;;REGULAR;;MALA")));
		$combo_oporfarmacia->ListData = $combo_oporfarmacia->ListItem;
	}
	$combo_oporfarmacia->SelectName = 'oporfarmacia';
	$combo_oporfarmacia->AllowNull = false;
	// combobox: totalidad
	$combo_totalidad = new Combo;
	$combo_totalidad->ListType = 0;
	$combo_totalidad->MultipleSeparator = ', ';
	$combo_totalidad->ListBoxHeight = 10;
	$combo_totalidad->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.totalidad.csv')) {
		$totalidad_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.totalidad.csv')));
		$combo_totalidad->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($totalidad_data)));
		$combo_totalidad->ListData = $combo_totalidad->ListItem;
	} else {
		$combo_totalidad->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO")));
		$combo_totalidad->ListData = $combo_totalidad->ListItem;
	}
	$combo_totalidad->SelectName = 'totalidad';
	$combo_totalidad->AllowNull = false;
	// combobox: cambio
	$combo_cambio = new Combo;
	$combo_cambio->ListType = 0;
	$combo_cambio->MultipleSeparator = ', ';
	$combo_cambio->ListBoxHeight = 10;
	$combo_cambio->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.cambio.csv')) {
		$cambio_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.cambio.csv')));
		$combo_cambio->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($cambio_data)));
		$combo_cambio->ListData = $combo_cambio->ListItem;
	} else {
		$combo_cambio->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO")));
		$combo_cambio->ListData = $combo_cambio->ListItem;
	}
	$combo_cambio->SelectName = 'cambio';
	$combo_cambio->AllowNull = false;
	// combobox: volver
	$combo_volver = new Combo;
	$combo_volver->ListType = 0;
	$combo_volver->MultipleSeparator = ', ';
	$combo_volver->ListBoxHeight = 10;
	$combo_volver->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.volver.csv')) {
		$volver_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.volver.csv')));
		$combo_volver->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($volver_data)));
		$combo_volver->ListData = $combo_volver->ListItem;
	} else {
		$combo_volver->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;CERO;;UNA;;DOS;;MAS VECES;;NO VOLVIO")));
		$combo_volver->ListData = $combo_volver->ListItem;
	}
	$combo_volver->SelectName = 'volver';
	$combo_volver->AllowNull = false;
	// combobox: orientacion
	$combo_orientacion = new Combo;
	$combo_orientacion->ListType = 0;
	$combo_orientacion->MultipleSeparator = ', ';
	$combo_orientacion->ListBoxHeight = 10;
	$combo_orientacion->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.orientacion.csv')) {
		$orientacion_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.orientacion.csv')));
		$combo_orientacion->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($orientacion_data)));
		$combo_orientacion->ListData = $combo_orientacion->ListItem;
	} else {
		$combo_orientacion->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO")));
		$combo_orientacion->ListData = $combo_orientacion->ListItem;
	}
	$combo_orientacion->SelectName = 'orientacion';
	$combo_orientacion->AllowNull = false;
	// combobox: embalaje
	$combo_embalaje = new Combo;
	$combo_embalaje->ListType = 0;
	$combo_embalaje->MultipleSeparator = ', ';
	$combo_embalaje->ListBoxHeight = 10;
	$combo_embalaje->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.embalaje.csv')) {
		$embalaje_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.embalaje.csv')));
		$combo_embalaje->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($embalaje_data)));
		$combo_embalaje->ListData = $combo_embalaje->ListItem;
	} else {
		$combo_embalaje->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;BOLSAS;;CAJAS;;PAPEL;;SIN EMBALAJE")));
		$combo_embalaje->ListData = $combo_embalaje->ListItem;
	}
	$combo_embalaje->SelectName = 'embalaje';
	$combo_embalaje->AllowNull = false;
	// combobox: revision
	$combo_revision = new Combo;
	$combo_revision->ListType = 0;
	$combo_revision->MultipleSeparator = ', ';
	$combo_revision->ListBoxHeight = 10;
	$combo_revision->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Encuesta.revision.csv')) {
		$revision_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Encuesta.revision.csv')));
		$combo_revision->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($revision_data)));
		$combo_revision->ListData = $combo_revision->ListItem;
	} else {
		$combo_revision->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions(";;SI;;NO")));
		$combo_revision->ListData = $combo_revision->ListItem;
	}
	$combo_revision->SelectName = 'revision';
	$combo_revision->AllowNull = false;

	if($selected_id) {
		// mm: check member permissions
		if(!$arrPerm['view']) return $Translation['tableAccessDenied'];

		// mm: who is the owner?
		$ownerGroupID = sqlValue("SELECT `groupID` FROM `membership_userrecords` WHERE `tableName`='Encuesta' AND `pkValue`='" . makeSafe($selected_id) . "'");
		$ownerMemberID = sqlValue("SELECT LCASE(`memberID`) FROM `membership_userrecords` WHERE `tableName`='Encuesta' AND `pkValue`='" . makeSafe($selected_id) . "'");

		if($arrPerm['view'] == 1 && getLoggedMemberID() != $ownerMemberID) return $Translation['tableAccessDenied'];
		if($arrPerm['view'] == 2 && getLoggedGroupID() != $ownerGroupID) return $Translation['tableAccessDenied'];

		// can edit?
		$AllowUpdate = 0;
		if(($arrPerm['edit'] == 1 && $ownerMemberID == getLoggedMemberID()) || ($arrPerm['edit'] == 2 && $ownerGroupID == getLoggedGroupID()) || $arrPerm['edit'] == 3) {
			$AllowUpdate = 1;
		}

		$res = sql("SELECT * FROM `Encuesta` WHERE `id`='" . makeSafe($selected_id) . "'", $eo);
		if(!($row = db_fetch_array($res))) {
			return error_message($Translation['No records found'], 'Encuesta_view.php', false);
		}
		$combo_fecha->DefaultDate = $row['fecha'];
		$combo_tipoid->SelectedData = $row['tipoid'];
		$combo_eps->SelectedData = $row['eps'];
		$combo_ipsprim->SelectedData = $row['ipsprim'];
		$combo_tratoser->SelectedData = $row['tratoser'];
		$combo_cita->SelectedData = $row['cita'];
		$combo_tratoasis->SelectedData = $row['tratoasis'];
		$combo_expprof->SelectedData = $row['expprof'];
		$combo_bioser->SelectedData = $row['bioser'];
		$combo_area->SelectedData = $row['area'];
		$combo_pyp->SelectedData = $row['pyp'];
		$combo_prenatal->SelectedData = $row['prenatal'];
		$combo_cyd->SelectedData = $row['cyd'];
		$combo_vacunas->SelectedData = $row['vacunas'];
		$combo_pfm->SelectedData = $row['pfm'];
		$combo_citologia->SelectedData = $row['citologia'];
		$combo_sservicio->SelectedData = $row['sservicio'];
		$combo_incomodo->SelectedData = $row['incomodo'];
		$combo_urgencia->SelectedData = $row['urgencia'];
		$combo_citaoportuna->SelectedData = $row['citaoportuna'];
		$combo_aspectoeps->SelectedData = $row['aspectoeps'];
		$combo_fisicas->SelectedData = $row['fisicas'];
		$combo_aseo->SelectedData = $row['aseo'];
		$combo_capacitacion->SelectedData = $row['capacitacion'];
		$combo_autorizaciones->SelectedData = $row['autorizaciones'];
		$combo_general->SelectedData = $row['general'];
		$combo_horario->SelectedData = $row['horario'];
		$combo_formulario->SelectedData = $row['formulario'];
		$combo_farmacia->SelectedData = $row['farmacia'];
		$combo_fisicasfarma->SelectedData = $row['fisicasfarma'];
		$combo_oporfarmacia->SelectedData = $row['oporfarmacia'];
		$combo_totalidad->SelectedData = $row['totalidad'];
		$combo_cambio->SelectedData = $row['cambio'];
		$combo_volver->SelectedData = $row['volver'];
		$combo_orientacion->SelectedData = $row['orientacion'];
		$combo_embalaje->SelectedData = $row['embalaje'];
		$combo_revision->SelectedData = $row['revision'];
		$urow = $row; /* unsanitized data */
		$row = array_map('safe_html', $row);
	} else {
		$combo_tipoid->SelectedText = ( $_REQUEST['FilterField'][1] == '3' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_eps->SelectedData = $filterer_eps;
		$combo_ipsprim->SelectedData = $filterer_ipsprim;
		$combo_tratoser->SelectedText = ( $_REQUEST['FilterField'][1] == '9' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_cita->SelectedText = ( $_REQUEST['FilterField'][1] == '10' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_tratoasis->SelectedText = ( $_REQUEST['FilterField'][1] == '11' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_expprof->SelectedText = ( $_REQUEST['FilterField'][1] == '12' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_bioser->SelectedText = ( $_REQUEST['FilterField'][1] == '13' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_area->SelectedText = ( $_REQUEST['FilterField'][1] == '14' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_pyp->SelectedText = ( $_REQUEST['FilterField'][1] == '15' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_prenatal->SelectedText = ( $_REQUEST['FilterField'][1] == '16' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_cyd->SelectedText = ( $_REQUEST['FilterField'][1] == '17' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_vacunas->SelectedText = ( $_REQUEST['FilterField'][1] == '18' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_pfm->SelectedText = ( $_REQUEST['FilterField'][1] == '19' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_citologia->SelectedText = ( $_REQUEST['FilterField'][1] == '20' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_sservicio->SelectedText = ( $_REQUEST['FilterField'][1] == '21' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_incomodo->SelectedText = ( $_REQUEST['FilterField'][1] == '22' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_urgencia->SelectedText = ( $_REQUEST['FilterField'][1] == '25' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_citaoportuna->SelectedText = ( $_REQUEST['FilterField'][1] == '26' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_aspectoeps->SelectedText = ( $_REQUEST['FilterField'][1] == '27' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_fisicas->SelectedText = ( $_REQUEST['FilterField'][1] == '28' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_aseo->SelectedText = ( $_REQUEST['FilterField'][1] == '29' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_capacitacion->SelectedText = ( $_REQUEST['FilterField'][1] == '30' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_autorizaciones->SelectedText = ( $_REQUEST['FilterField'][1] == '31' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_general->SelectedText = ( $_REQUEST['FilterField'][1] == '32' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_horario->SelectedText = ( $_REQUEST['FilterField'][1] == '33' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_formulario->SelectedText = ( $_REQUEST['FilterField'][1] == '34' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_farmacia->SelectedText = ( $_REQUEST['FilterField'][1] == '35' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_fisicasfarma->SelectedText = ( $_REQUEST['FilterField'][1] == '36' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_oporfarmacia->SelectedText = ( $_REQUEST['FilterField'][1] == '37' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_totalidad->SelectedText = ( $_REQUEST['FilterField'][1] == '38' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_cambio->SelectedText = ( $_REQUEST['FilterField'][1] == '39' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_volver->SelectedText = ( $_REQUEST['FilterField'][1] == '40' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_orientacion->SelectedText = ( $_REQUEST['FilterField'][1] == '41' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_embalaje->SelectedText = ( $_REQUEST['FilterField'][1] == '42' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
		$combo_revision->SelectedText = ( $_REQUEST['FilterField'][1] == '43' && $_REQUEST['FilterOperator'][1] == '<=>' ? $_REQUEST['FilterValue'][1] : '');
	}
	$combo_tipoid->Render();
	$combo_eps->HTML = '<span id="eps-container' . $rnd1 . '"></span><input type="hidden" name="eps" id="eps' . $rnd1 . '" value="' . html_attr($combo_eps->SelectedData) . '">';
	$combo_eps->MatchText = '<span id="eps-container-readonly' . $rnd1 . '"></span><input type="hidden" name="eps" id="eps' . $rnd1 . '" value="' . html_attr($combo_eps->SelectedData) . '">';
	$combo_ipsprim->HTML = '<span id="ipsprim-container' . $rnd1 . '"></span><input type="hidden" name="ipsprim" id="ipsprim' . $rnd1 . '" value="' . html_attr($combo_ipsprim->SelectedData) . '">';
	$combo_ipsprim->MatchText = '<span id="ipsprim-container-readonly' . $rnd1 . '"></span><input type="hidden" name="ipsprim" id="ipsprim' . $rnd1 . '" value="' . html_attr($combo_ipsprim->SelectedData) . '">';
	$combo_tratoser->Render();
	$combo_cita->Render();
	$combo_tratoasis->Render();
	$combo_expprof->Render();
	$combo_bioser->Render();
	$combo_area->Render();
	$combo_pyp->Render();
	$combo_prenatal->Render();
	$combo_cyd->Render();
	$combo_vacunas->Render();
	$combo_pfm->Render();
	$combo_citologia->Render();
	$combo_sservicio->Render();
	$combo_incomodo->Render();
	$combo_urgencia->Render();
	$combo_citaoportuna->Render();
	$combo_aspectoeps->Render();
	$combo_fisicas->Render();
	$combo_aseo->Render();
	$combo_capacitacion->Render();
	$combo_autorizaciones->Render();
	$combo_general->Render();
	$combo_horario->Render();
	$combo_formulario->Render();
	$combo_farmacia->Render();
	$combo_fisicasfarma->Render();
	$combo_oporfarmacia->Render();
	$combo_totalidad->Render();
	$combo_cambio->Render();
	$combo_volver->Render();
	$combo_orientacion->Render();
	$combo_embalaje->Render();
	$combo_revision->Render();

	ob_start();
	?>

	<script>
		// initial lookup values
		AppGini.current_eps__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['eps'] : htmlspecialchars($filterer_eps, ENT_QUOTES)); ?>"};
		AppGini.current_ipsprim__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['ipsprim'] : htmlspecialchars($filterer_ipsprim, ENT_QUOTES)); ?>"};

		jQuery(function() {
			setTimeout(function() {
				if(typeof(eps_reload__RAND__) == 'function') eps_reload__RAND__();
				if(typeof(ipsprim_reload__RAND__) == 'function') ipsprim_reload__RAND__();
			}, 50); /* we need to slightly delay client-side execution of the above code to allow AppGini.ajaxCache to work */
		});
		function eps_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#eps-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_eps__RAND__.value, t: 'Encuesta', f: 'eps' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="eps"]').val(resp.results[0].id);
							$j('[id=eps-container-readonly__RAND__]').html('<span id="eps-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=eps_view_parent]').hide(); } else { $j('.btn[id=eps_view_parent]').show(); }


							if(typeof(eps_update_autofills__RAND__) == 'function') eps_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'Encuesta', f: 'eps' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_eps__RAND__.value = e.added.id;
				AppGini.current_eps__RAND__.text = e.added.text;
				$j('[name="eps"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=eps_view_parent]').hide(); } else { $j('.btn[id=eps_view_parent]').show(); }


				if(typeof(eps_update_autofills__RAND__) == 'function') eps_update_autofills__RAND__();
			});

			if(!$j("#eps-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_eps__RAND__.value, t: 'Encuesta', f: 'eps' },
					success: function(resp) {
						$j('[name="eps"]').val(resp.results[0].id);
						$j('[id=eps-container-readonly__RAND__]').html('<span id="eps-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=eps_view_parent]').hide(); } else { $j('.btn[id=eps_view_parent]').show(); }

						if(typeof(eps_update_autofills__RAND__) == 'function') eps_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_eps__RAND__.value, t: 'Encuesta', f: 'eps' },
				success: function(resp) {
					$j('[id=eps-container__RAND__], [id=eps-container-readonly__RAND__]').html('<span id="eps-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=eps_view_parent]').hide(); } else { $j('.btn[id=eps_view_parent]').show(); }

					if(typeof(eps_update_autofills__RAND__) == 'function') eps_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function ipsprim_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#ipsprim-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_ipsprim__RAND__.value, t: 'Encuesta', f: 'ipsprim' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="ipsprim"]').val(resp.results[0].id);
							$j('[id=ipsprim-container-readonly__RAND__]').html('<span id="ipsprim-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=ips_view_parent]').hide(); } else { $j('.btn[id=ips_view_parent]').show(); }


							if(typeof(ipsprim_update_autofills__RAND__) == 'function') ipsprim_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'Encuesta', f: 'ipsprim' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_ipsprim__RAND__.value = e.added.id;
				AppGini.current_ipsprim__RAND__.text = e.added.text;
				$j('[name="ipsprim"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=ips_view_parent]').hide(); } else { $j('.btn[id=ips_view_parent]').show(); }


				if(typeof(ipsprim_update_autofills__RAND__) == 'function') ipsprim_update_autofills__RAND__();
			});

			if(!$j("#ipsprim-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_ipsprim__RAND__.value, t: 'Encuesta', f: 'ipsprim' },
					success: function(resp) {
						$j('[name="ipsprim"]').val(resp.results[0].id);
						$j('[id=ipsprim-container-readonly__RAND__]').html('<span id="ipsprim-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=ips_view_parent]').hide(); } else { $j('.btn[id=ips_view_parent]').show(); }

						if(typeof(ipsprim_update_autofills__RAND__) == 'function') ipsprim_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_ipsprim__RAND__.value, t: 'Encuesta', f: 'ipsprim' },
				success: function(resp) {
					$j('[id=ipsprim-container__RAND__], [id=ipsprim-container-readonly__RAND__]').html('<span id="ipsprim-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=ips_view_parent]').hide(); } else { $j('.btn[id=ips_view_parent]').show(); }

					if(typeof(ipsprim_update_autofills__RAND__) == 'function') ipsprim_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
	</script>
	<?php

	$lookups = str_replace('__RAND__', $rnd1, ob_get_contents());
	ob_end_clean();


	// code for template based detail view forms

	// open the detail view template
	$template_file = is_file("./{$TemplateDV}") ? "./{$TemplateDV}" : './templates/Encuesta_templateDV.html';
	$templateCode = @file_get_contents($template_file);

	// process form title
	$templateCode = str_replace('<%%DETAIL_VIEW_TITLE%%>', 'Completar Encuestas', $templateCode);
	$templateCode = str_replace('<%%RND1%%>', $rnd1, $templateCode);
	$templateCode = str_replace('<%%EMBEDDED%%>', ($_REQUEST['Embedded'] ? 'Embedded=1' : ''), $templateCode);
	// process buttons
	if($arrPerm[1] && !$selected_id) { // allow insert and no record selected?
		if(!$selected_id) $templateCode = str_replace('<%%INSERT_BUTTON%%>', '<button type="submit" class="btn btn-success" id="insert" name="insert_x" value="1" onclick="return Encuesta_validateData();"><i class="glyphicon glyphicon-plus-sign"></i> ' . $Translation['Save New'] . '</button>', $templateCode);
		$templateCode = str_replace('<%%INSERT_BUTTON%%>', '<button type="submit" class="btn btn-default" id="insert" name="insert_x" value="1" onclick="return Encuesta_validateData();"><i class="glyphicon glyphicon-plus-sign"></i> ' . $Translation['Save As Copy'] . '</button>', $templateCode);
	} else {
		$templateCode = str_replace('<%%INSERT_BUTTON%%>', '', $templateCode);
	}

	// 'Back' button action
	if($_REQUEST['Embedded']) {
		$backAction = 'AppGini.closeParentModal(); return false;';
	} else {
		$backAction = '$j(\'form\').eq(0).attr(\'novalidate\', \'novalidate\'); document.myform.reset(); return true;';
	}

	if($selected_id) {
		if($AllowUpdate) {
			$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '<button type="submit" class="btn btn-success btn-lg" id="update" name="update_x" value="1" onclick="return Encuesta_validateData();" title="' . html_attr($Translation['Save Changes']) . '"><i class="glyphicon glyphicon-ok"></i> ' . $Translation['Save Changes'] . '</button>', $templateCode);
		} else {
			$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '', $templateCode);
		}
		if(($arrPerm[4]==1 && $ownerMemberID==getLoggedMemberID()) || ($arrPerm[4]==2 && $ownerGroupID==getLoggedGroupID()) || $arrPerm[4]==3) { // allow delete?
			$templateCode = str_replace('<%%DELETE_BUTTON%%>', '<button type="submit" class="btn btn-danger" id="delete" name="delete_x" value="1" onclick="return confirm(\'' . $Translation['are you sure?'] . '\');" title="' . html_attr($Translation['Delete']) . '"><i class="glyphicon glyphicon-trash"></i> ' . $Translation['Delete'] . '</button>', $templateCode);
		} else {
			$templateCode = str_replace('<%%DELETE_BUTTON%%>', '', $templateCode);
		}
		$templateCode = str_replace('<%%DESELECT_BUTTON%%>', '<button type="submit" class="btn btn-default" id="deselect" name="deselect_x" value="1" onclick="' . $backAction . '" title="' . html_attr($Translation['Back']) . '"><i class="glyphicon glyphicon-chevron-left"></i> ' . $Translation['Back'] . '</button>', $templateCode);
	} else {
		$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '', $templateCode);
		$templateCode = str_replace('<%%DELETE_BUTTON%%>', '', $templateCode);
		$templateCode = str_replace('<%%DESELECT_BUTTON%%>', ($ShowCancel ? '<button type="submit" class="btn btn-default" id="deselect" name="deselect_x" value="1" onclick="' . $backAction . '" title="' . html_attr($Translation['Back']) . '"><i class="glyphicon glyphicon-chevron-left"></i> ' . $Translation['Back'] . '</button>' : ''), $templateCode);
	}

	// set records to read only if user can't insert new records and can't edit current record
	if(($selected_id && !$AllowUpdate) || (!$selected_id && !$AllowInsert)) {
		$jsReadOnly = '';
		$jsReadOnly .= "\tjQuery('#tipoid').replaceWith('<div class=\"form-control-static\" id=\"tipoid\">' + (jQuery('#tipoid').val() || '') + '</div>'); jQuery('#tipoid-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#doc').replaceWith('<div class=\"form-control-static\" id=\"doc\">' + (jQuery('#doc').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#nombres').replaceWith('<div class=\"form-control-static\" id=\"nombres\">' + (jQuery('#nombres').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#apellidos').replaceWith('<div class=\"form-control-static\" id=\"apellidos\">' + (jQuery('#apellidos').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#eps').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#eps_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#ipsprim').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#ipsprim_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#tratoser').replaceWith('<div class=\"form-control-static\" id=\"tratoser\">' + (jQuery('#tratoser').val() || '') + '</div>'); jQuery('#tratoser-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#cita').replaceWith('<div class=\"form-control-static\" id=\"cita\">' + (jQuery('#cita').val() || '') + '</div>'); jQuery('#cita-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#tratoasis').replaceWith('<div class=\"form-control-static\" id=\"tratoasis\">' + (jQuery('#tratoasis').val() || '') + '</div>'); jQuery('#tratoasis-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#expprof').replaceWith('<div class=\"form-control-static\" id=\"expprof\">' + (jQuery('#expprof').val() || '') + '</div>'); jQuery('#expprof-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#bioser').replaceWith('<div class=\"form-control-static\" id=\"bioser\">' + (jQuery('#bioser').val() || '') + '</div>'); jQuery('#bioser-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#area').replaceWith('<div class=\"form-control-static\" id=\"area\">' + (jQuery('#area').val() || '') + '</div>'); jQuery('#area-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#pyp').replaceWith('<div class=\"form-control-static\" id=\"pyp\">' + (jQuery('#pyp').val() || '') + '</div>'); jQuery('#pyp-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#prenatal').replaceWith('<div class=\"form-control-static\" id=\"prenatal\">' + (jQuery('#prenatal').val() || '') + '</div>'); jQuery('#prenatal-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#cyd').replaceWith('<div class=\"form-control-static\" id=\"cyd\">' + (jQuery('#cyd').val() || '') + '</div>'); jQuery('#cyd-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#vacunas').replaceWith('<div class=\"form-control-static\" id=\"vacunas\">' + (jQuery('#vacunas').val() || '') + '</div>'); jQuery('#vacunas-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#pfm').replaceWith('<div class=\"form-control-static\" id=\"pfm\">' + (jQuery('#pfm').val() || '') + '</div>'); jQuery('#pfm-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#citologia').replaceWith('<div class=\"form-control-static\" id=\"citologia\">' + (jQuery('#citologia').val() || '') + '</div>'); jQuery('#citologia-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#sservicio').replaceWith('<div class=\"form-control-static\" id=\"sservicio\">' + (jQuery('#sservicio').val() || '') + '</div>'); jQuery('#sservicio-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#incomodo').replaceWith('<div class=\"form-control-static\" id=\"incomodo\">' + (jQuery('#incomodo').val() || '') + '</div>'); jQuery('#incomodo-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#otro').replaceWith('<div class=\"form-control-static\" id=\"otro\">' + (jQuery('#otro').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#why').replaceWith('<div class=\"form-control-static\" id=\"why\">' + (jQuery('#why').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#urgencia').replaceWith('<div class=\"form-control-static\" id=\"urgencia\">' + (jQuery('#urgencia').val() || '') + '</div>'); jQuery('#urgencia-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#citaoportuna').replaceWith('<div class=\"form-control-static\" id=\"citaoportuna\">' + (jQuery('#citaoportuna').val() || '') + '</div>'); jQuery('#citaoportuna-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#aspectoeps').replaceWith('<div class=\"form-control-static\" id=\"aspectoeps\">' + (jQuery('#aspectoeps').val() || '') + '</div>'); jQuery('#aspectoeps-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#fisicas').replaceWith('<div class=\"form-control-static\" id=\"fisicas\">' + (jQuery('#fisicas').val() || '') + '</div>'); jQuery('#fisicas-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#aseo').replaceWith('<div class=\"form-control-static\" id=\"aseo\">' + (jQuery('#aseo').val() || '') + '</div>'); jQuery('#aseo-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#capacitacion').replaceWith('<div class=\"form-control-static\" id=\"capacitacion\">' + (jQuery('#capacitacion').val() || '') + '</div>'); jQuery('#capacitacion-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#autorizaciones').replaceWith('<div class=\"form-control-static\" id=\"autorizaciones\">' + (jQuery('#autorizaciones').val() || '') + '</div>'); jQuery('#autorizaciones-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#general').replaceWith('<div class=\"form-control-static\" id=\"general\">' + (jQuery('#general').val() || '') + '</div>'); jQuery('#general-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#horario').replaceWith('<div class=\"form-control-static\" id=\"horario\">' + (jQuery('#horario').val() || '') + '</div>'); jQuery('#horario-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#formulario').replaceWith('<div class=\"form-control-static\" id=\"formulario\">' + (jQuery('#formulario').val() || '') + '</div>'); jQuery('#formulario-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#farmacia').replaceWith('<div class=\"form-control-static\" id=\"farmacia\">' + (jQuery('#farmacia').val() || '') + '</div>'); jQuery('#farmacia-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#fisicasfarma').replaceWith('<div class=\"form-control-static\" id=\"fisicasfarma\">' + (jQuery('#fisicasfarma').val() || '') + '</div>'); jQuery('#fisicasfarma-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#oporfarmacia').replaceWith('<div class=\"form-control-static\" id=\"oporfarmacia\">' + (jQuery('#oporfarmacia').val() || '') + '</div>'); jQuery('#oporfarmacia-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#totalidad').replaceWith('<div class=\"form-control-static\" id=\"totalidad\">' + (jQuery('#totalidad').val() || '') + '</div>'); jQuery('#totalidad-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#cambio').replaceWith('<div class=\"form-control-static\" id=\"cambio\">' + (jQuery('#cambio').val() || '') + '</div>'); jQuery('#cambio-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#volver').replaceWith('<div class=\"form-control-static\" id=\"volver\">' + (jQuery('#volver').val() || '') + '</div>'); jQuery('#volver-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#orientacion').replaceWith('<div class=\"form-control-static\" id=\"orientacion\">' + (jQuery('#orientacion').val() || '') + '</div>'); jQuery('#orientacion-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#embalaje').replaceWith('<div class=\"form-control-static\" id=\"embalaje\">' + (jQuery('#embalaje').val() || '') + '</div>'); jQuery('#embalaje-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#revision').replaceWith('<div class=\"form-control-static\" id=\"revision\">' + (jQuery('#revision').val() || '') + '</div>'); jQuery('#revision-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#observaciones').replaceWith('<div class=\"form-control-static\" id=\"observaciones\">' + (jQuery('#observaciones').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('.select2-container').hide();\n";

		$noUploads = true;
	} elseif(($AllowInsert && !$selected_id) || ($AllowUpdate && $selected_id)) {
		$jsEditable = "\tjQuery('form').eq(0).data('already_changed', true);"; // temporarily disable form change handler
		$jsEditable .= "\tjQuery('form').eq(0).data('already_changed', false);"; // re-enable form change handler
	}

	// process combos
	$templateCode = str_replace('<%%COMBO(fecha)%%>', ($selected_id && !$arrPerm[3] ? '<div class="form-control-static">' . $combo_fecha->GetHTML(true) . '</div>' : $combo_fecha->GetHTML()), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(fecha)%%>', $combo_fecha->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(tipoid)%%>', $combo_tipoid->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(tipoid)%%>', $combo_tipoid->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(eps)%%>', $combo_eps->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(eps)%%>', $combo_eps->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(eps)%%>', urlencode($combo_eps->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(ipsprim)%%>', $combo_ipsprim->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(ipsprim)%%>', $combo_ipsprim->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(ipsprim)%%>', urlencode($combo_ipsprim->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(tratoser)%%>', $combo_tratoser->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(tratoser)%%>', $combo_tratoser->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(cita)%%>', $combo_cita->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(cita)%%>', $combo_cita->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(tratoasis)%%>', $combo_tratoasis->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(tratoasis)%%>', $combo_tratoasis->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(expprof)%%>', $combo_expprof->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(expprof)%%>', $combo_expprof->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(bioser)%%>', $combo_bioser->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(bioser)%%>', $combo_bioser->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(area)%%>', $combo_area->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(area)%%>', $combo_area->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(pyp)%%>', $combo_pyp->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(pyp)%%>', $combo_pyp->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(prenatal)%%>', $combo_prenatal->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(prenatal)%%>', $combo_prenatal->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(cyd)%%>', $combo_cyd->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(cyd)%%>', $combo_cyd->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(vacunas)%%>', $combo_vacunas->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(vacunas)%%>', $combo_vacunas->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(pfm)%%>', $combo_pfm->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(pfm)%%>', $combo_pfm->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(citologia)%%>', $combo_citologia->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(citologia)%%>', $combo_citologia->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(sservicio)%%>', $combo_sservicio->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(sservicio)%%>', $combo_sservicio->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(incomodo)%%>', $combo_incomodo->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(incomodo)%%>', $combo_incomodo->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(urgencia)%%>', $combo_urgencia->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(urgencia)%%>', $combo_urgencia->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(citaoportuna)%%>', $combo_citaoportuna->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(citaoportuna)%%>', $combo_citaoportuna->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(aspectoeps)%%>', $combo_aspectoeps->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(aspectoeps)%%>', $combo_aspectoeps->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(fisicas)%%>', $combo_fisicas->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(fisicas)%%>', $combo_fisicas->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(aseo)%%>', $combo_aseo->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(aseo)%%>', $combo_aseo->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(capacitacion)%%>', $combo_capacitacion->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(capacitacion)%%>', $combo_capacitacion->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(autorizaciones)%%>', $combo_autorizaciones->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(autorizaciones)%%>', $combo_autorizaciones->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(general)%%>', $combo_general->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(general)%%>', $combo_general->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(horario)%%>', $combo_horario->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(horario)%%>', $combo_horario->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(formulario)%%>', $combo_formulario->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(formulario)%%>', $combo_formulario->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(farmacia)%%>', $combo_farmacia->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(farmacia)%%>', $combo_farmacia->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(fisicasfarma)%%>', $combo_fisicasfarma->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(fisicasfarma)%%>', $combo_fisicasfarma->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(oporfarmacia)%%>', $combo_oporfarmacia->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(oporfarmacia)%%>', $combo_oporfarmacia->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(totalidad)%%>', $combo_totalidad->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(totalidad)%%>', $combo_totalidad->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(cambio)%%>', $combo_cambio->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(cambio)%%>', $combo_cambio->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(volver)%%>', $combo_volver->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(volver)%%>', $combo_volver->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(orientacion)%%>', $combo_orientacion->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(orientacion)%%>', $combo_orientacion->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(embalaje)%%>', $combo_embalaje->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(embalaje)%%>', $combo_embalaje->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(revision)%%>', $combo_revision->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(revision)%%>', $combo_revision->SelectedData, $templateCode);

	/* lookup fields array: 'lookup field name' => array('parent table name', 'lookup field caption') */
	$lookup_fields = array('eps' => array('eps', 'EPS'), 'ipsprim' => array('ips', 'IPS Primaria'), );
	foreach($lookup_fields as $luf => $ptfc) {
		$pt_perm = getTablePermissions($ptfc[0]);

		// process foreign key links
		if($pt_perm['view'] || $pt_perm['edit']) {
			$templateCode = str_replace("<%%PLINK({$luf})%%>", '<button type="button" class="btn btn-default view_parent hspacer-md" id="' . $ptfc[0] . '_view_parent" title="' . html_attr($Translation['View'] . ' ' . $ptfc[1]) . '"><i class="glyphicon glyphicon-eye-open"></i></button>', $templateCode);
		}

		// if user has insert permission to parent table of a lookup field, put an add new button
		if($pt_perm['insert'] /* && !$_REQUEST['Embedded']*/) {
			$templateCode = str_replace("<%%ADDNEW({$ptfc[0]})%%>", '<button type="button" class="btn btn-success add_new_parent hspacer-md" id="' . $ptfc[0] . '_add_new" title="' . html_attr($Translation['Add New'] . ' ' . $ptfc[1]) . '"><i class="glyphicon glyphicon-plus-sign"></i></button>', $templateCode);
		}
	}

	// process images
	$templateCode = str_replace('<%%UPLOADFILE(id)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(fecha)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(tipoid)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(doc)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(nombres)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(apellidos)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(eps)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(ipsprim)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(tratoser)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(cita)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(tratoasis)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(expprof)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(bioser)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(area)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(pyp)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(prenatal)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(cyd)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(vacunas)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(pfm)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(citologia)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(sservicio)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(incomodo)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(otro)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(why)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(urgencia)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(citaoportuna)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(aspectoeps)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(fisicas)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(aseo)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(capacitacion)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(autorizaciones)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(general)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(horario)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(formulario)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(farmacia)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(fisicasfarma)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(oporfarmacia)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(totalidad)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(cambio)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(volver)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(orientacion)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(embalaje)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(revision)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(observaciones)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(user)%%>', '', $templateCode);

	// process values
	if($selected_id) {
		if( $dvprint) $templateCode = str_replace('<%%VALUE(id)%%>', safe_html($urow['id']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(id)%%>', html_attr($row['id']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(id)%%>', urlencode($urow['id']), $templateCode);
		$templateCode = str_replace('<%%VALUE(fecha)%%>', @date('d/m/Y', @strtotime(html_attr($row['fecha']))), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(fecha)%%>', urlencode(@date('d/m/Y', @strtotime(html_attr($urow['fecha'])))), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(tipoid)%%>', safe_html($urow['tipoid']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(tipoid)%%>', html_attr($row['tipoid']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(tipoid)%%>', urlencode($urow['tipoid']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(doc)%%>', safe_html($urow['doc']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(doc)%%>', html_attr($row['doc']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(doc)%%>', urlencode($urow['doc']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(nombres)%%>', safe_html($urow['nombres']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(nombres)%%>', html_attr($row['nombres']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(nombres)%%>', urlencode($urow['nombres']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(apellidos)%%>', safe_html($urow['apellidos']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(apellidos)%%>', html_attr($row['apellidos']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(apellidos)%%>', urlencode($urow['apellidos']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(eps)%%>', safe_html($urow['eps']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(eps)%%>', html_attr($row['eps']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(eps)%%>', urlencode($urow['eps']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(ipsprim)%%>', safe_html($urow['ipsprim']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(ipsprim)%%>', html_attr($row['ipsprim']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(ipsprim)%%>', urlencode($urow['ipsprim']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(tratoser)%%>', safe_html($urow['tratoser']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(tratoser)%%>', html_attr($row['tratoser']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(tratoser)%%>', urlencode($urow['tratoser']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(cita)%%>', safe_html($urow['cita']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(cita)%%>', html_attr($row['cita']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(cita)%%>', urlencode($urow['cita']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(tratoasis)%%>', safe_html($urow['tratoasis']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(tratoasis)%%>', html_attr($row['tratoasis']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(tratoasis)%%>', urlencode($urow['tratoasis']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(expprof)%%>', safe_html($urow['expprof']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(expprof)%%>', html_attr($row['expprof']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(expprof)%%>', urlencode($urow['expprof']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(bioser)%%>', safe_html($urow['bioser']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(bioser)%%>', html_attr($row['bioser']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(bioser)%%>', urlencode($urow['bioser']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(area)%%>', safe_html($urow['area']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(area)%%>', html_attr($row['area']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(area)%%>', urlencode($urow['area']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(pyp)%%>', safe_html($urow['pyp']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(pyp)%%>', html_attr($row['pyp']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(pyp)%%>', urlencode($urow['pyp']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(prenatal)%%>', safe_html($urow['prenatal']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(prenatal)%%>', html_attr($row['prenatal']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(prenatal)%%>', urlencode($urow['prenatal']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(cyd)%%>', safe_html($urow['cyd']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(cyd)%%>', html_attr($row['cyd']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(cyd)%%>', urlencode($urow['cyd']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(vacunas)%%>', safe_html($urow['vacunas']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(vacunas)%%>', html_attr($row['vacunas']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(vacunas)%%>', urlencode($urow['vacunas']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(pfm)%%>', safe_html($urow['pfm']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(pfm)%%>', html_attr($row['pfm']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(pfm)%%>', urlencode($urow['pfm']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(citologia)%%>', safe_html($urow['citologia']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(citologia)%%>', html_attr($row['citologia']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(citologia)%%>', urlencode($urow['citologia']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(sservicio)%%>', safe_html($urow['sservicio']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(sservicio)%%>', html_attr($row['sservicio']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(sservicio)%%>', urlencode($urow['sservicio']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(incomodo)%%>', safe_html($urow['incomodo']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(incomodo)%%>', html_attr($row['incomodo']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(incomodo)%%>', urlencode($urow['incomodo']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(otro)%%>', safe_html($urow['otro']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(otro)%%>', html_attr($row['otro']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(otro)%%>', urlencode($urow['otro']), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(why)%%>', safe_html($urow['why']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(why)%%>', safe_html($urow['why'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(why)%%>', urlencode($urow['why']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(urgencia)%%>', safe_html($urow['urgencia']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(urgencia)%%>', html_attr($row['urgencia']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(urgencia)%%>', urlencode($urow['urgencia']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(citaoportuna)%%>', safe_html($urow['citaoportuna']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(citaoportuna)%%>', html_attr($row['citaoportuna']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(citaoportuna)%%>', urlencode($urow['citaoportuna']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(aspectoeps)%%>', safe_html($urow['aspectoeps']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(aspectoeps)%%>', html_attr($row['aspectoeps']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(aspectoeps)%%>', urlencode($urow['aspectoeps']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(fisicas)%%>', safe_html($urow['fisicas']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(fisicas)%%>', html_attr($row['fisicas']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(fisicas)%%>', urlencode($urow['fisicas']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(aseo)%%>', safe_html($urow['aseo']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(aseo)%%>', html_attr($row['aseo']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(aseo)%%>', urlencode($urow['aseo']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(capacitacion)%%>', safe_html($urow['capacitacion']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(capacitacion)%%>', html_attr($row['capacitacion']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(capacitacion)%%>', urlencode($urow['capacitacion']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(autorizaciones)%%>', safe_html($urow['autorizaciones']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(autorizaciones)%%>', html_attr($row['autorizaciones']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(autorizaciones)%%>', urlencode($urow['autorizaciones']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(general)%%>', safe_html($urow['general']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(general)%%>', html_attr($row['general']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(general)%%>', urlencode($urow['general']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(horario)%%>', safe_html($urow['horario']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(horario)%%>', html_attr($row['horario']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(horario)%%>', urlencode($urow['horario']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(formulario)%%>', safe_html($urow['formulario']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(formulario)%%>', html_attr($row['formulario']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(formulario)%%>', urlencode($urow['formulario']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(farmacia)%%>', safe_html($urow['farmacia']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(farmacia)%%>', html_attr($row['farmacia']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(farmacia)%%>', urlencode($urow['farmacia']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(fisicasfarma)%%>', safe_html($urow['fisicasfarma']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(fisicasfarma)%%>', html_attr($row['fisicasfarma']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(fisicasfarma)%%>', urlencode($urow['fisicasfarma']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(oporfarmacia)%%>', safe_html($urow['oporfarmacia']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(oporfarmacia)%%>', html_attr($row['oporfarmacia']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(oporfarmacia)%%>', urlencode($urow['oporfarmacia']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(totalidad)%%>', safe_html($urow['totalidad']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(totalidad)%%>', html_attr($row['totalidad']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(totalidad)%%>', urlencode($urow['totalidad']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(cambio)%%>', safe_html($urow['cambio']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(cambio)%%>', html_attr($row['cambio']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(cambio)%%>', urlencode($urow['cambio']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(volver)%%>', safe_html($urow['volver']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(volver)%%>', html_attr($row['volver']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(volver)%%>', urlencode($urow['volver']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(orientacion)%%>', safe_html($urow['orientacion']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(orientacion)%%>', html_attr($row['orientacion']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(orientacion)%%>', urlencode($urow['orientacion']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(embalaje)%%>', safe_html($urow['embalaje']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(embalaje)%%>', html_attr($row['embalaje']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(embalaje)%%>', urlencode($urow['embalaje']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(revision)%%>', safe_html($urow['revision']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(revision)%%>', html_attr($row['revision']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(revision)%%>', urlencode($urow['revision']), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(observaciones)%%>', safe_html($urow['observaciones']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(observaciones)%%>', safe_html($urow['observaciones'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(observaciones)%%>', urlencode($urow['observaciones']), $templateCode);
		$templateCode = str_replace('<%%VALUE(user)%%>', safe_html($urow['user']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(user)%%>', urlencode($urow['user']), $templateCode);
	} else {
		$templateCode = str_replace('<%%VALUE(id)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(id)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(fecha)%%>', '<%%creationDate%%>', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(fecha)%%>', urlencode('<%%creationDate%%>'), $templateCode);
		$templateCode = str_replace('<%%VALUE(tipoid)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(tipoid)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(doc)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(doc)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(nombres)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(nombres)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(apellidos)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(apellidos)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(eps)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(eps)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(ipsprim)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(ipsprim)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(tratoser)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(tratoser)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(cita)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(cita)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(tratoasis)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(tratoasis)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(expprof)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(expprof)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(bioser)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(bioser)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(area)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(area)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(pyp)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(pyp)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(prenatal)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(prenatal)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(cyd)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(cyd)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(vacunas)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(vacunas)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(pfm)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(pfm)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(citologia)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(citologia)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(sservicio)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(sservicio)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(incomodo)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(incomodo)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(otro)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(otro)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(why)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(why)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(urgencia)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(urgencia)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(citaoportuna)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(citaoportuna)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(aspectoeps)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(aspectoeps)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(fisicas)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(fisicas)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(aseo)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(aseo)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(capacitacion)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(capacitacion)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(autorizaciones)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(autorizaciones)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(general)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(general)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(horario)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(horario)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(formulario)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(formulario)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(farmacia)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(farmacia)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(fisicasfarma)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(fisicasfarma)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(oporfarmacia)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(oporfarmacia)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(totalidad)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(totalidad)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(cambio)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(cambio)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(volver)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(volver)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(orientacion)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(orientacion)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(embalaje)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(embalaje)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(revision)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(revision)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(observaciones)%%>', 'NINGUNA', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(observaciones)%%>', urlencode('NINGUNA'), $templateCode);
		$templateCode = str_replace('<%%VALUE(user)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(user)%%>', urlencode(''), $templateCode);
	}

	// process translations
	$templateCode = parseTemplate($templateCode);

	// clear scrap
	$templateCode = str_replace('<%%', '<!-- ', $templateCode);
	$templateCode = str_replace('%%>', ' -->', $templateCode);

	// hide links to inaccessible tables
	if($_REQUEST['dvprint_x'] == '') {
		$templateCode .= "\n\n<script>\$j(function() {\n";
		$arrTables = getTableList();
		foreach($arrTables as $name => $caption) {
			$templateCode .= "\t\$j('#{$name}_link').removeClass('hidden');\n";
			$templateCode .= "\t\$j('#xs_{$name}_link').removeClass('hidden');\n";
		}

		$templateCode .= $jsReadOnly;
		$templateCode .= $jsEditable;

		if(!$selected_id) {
		}

		$templateCode.="\n});</script>\n";
	}

	// ajaxed auto-fill fields
	$templateCode .= '<script>';
	$templateCode .= '$j(function() {';


	$templateCode.="});";
	$templateCode.="</script>";
	$templateCode .= $lookups;

	// handle enforced parent values for read-only lookup fields

	// don't include blank images in lightbox gallery
	$templateCode = preg_replace('/blank.gif" data-lightbox=".*?"/', 'blank.gif"', $templateCode);

	// don't display empty email links
	$templateCode=preg_replace('/<a .*?href="mailto:".*?<\/a>/', '', $templateCode);

	/* default field values */
	$rdata = $jdata = get_defaults('Encuesta');
	if($selected_id) {
		$jdata = get_joined_record('Encuesta', $selected_id);
		if($jdata === false) $jdata = get_defaults('Encuesta');
		$rdata = $row;
	}
	$templateCode .= loadView('Encuesta-ajax-cache', array('rdata' => $rdata, 'jdata' => $jdata));

	// hook: Encuesta_dv
	if(function_exists('Encuesta_dv')) {
		$args=[];
		Encuesta_dv(($selected_id ? $selected_id : FALSE), getMemberInfo(), $templateCode, $args);
	}

	return $templateCode;
}